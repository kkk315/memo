---
data: 2025-07-22
---

現在ルータとしてNECのAtermのAterm WG1900HP2を使っています。
現在はBIGLOBEのv6プラスとインターリンクの固定IP(PPPoE)を契約しているため、PPPoEモードにしてIPv4でポート開放しつつIPv6でも接続できるようになっています。
あまり気にしていませんでしたが、IPv6動作モードがIPv6ブリッジだとLAN内の全てにグローバルなIPv6アドレスが付与されるため、なんだかよろしくないという話を聞き、動作モードをND Proxyに変更しました。

インターネットへの疎通自体は特に問題なくできていたわけですが、ふと設定を確認するために自宅のVMにアクセスしようとしたところ、内部DNSで名前解決ができない事象が発生しました。

調べてみた所、NECのルータでND Proxyを設定すると同時にDHCPv6も有効になってしまうようで、DHCPv6ではDNSも強制的に押し付けられてしまうらしい。
内部DNSよりも先にDHCPv6で飛んできたDNSに優先的にアクセスしてしまうことで、内部DNSで解決すべきホスト名を外に聞きに行ってしまうという挙動をしていたようでした。

ホーム→IPv6LAN側設定　からDHCPv6サーバを「使用しない」に設定し、RAオプションによるDNSv6サーバアドレス通知はONのままにしておくことで対策完了です。

元々IPv6のDNSサーバーアドレス自体は通知されていましたが、DHCPv6ではその優先度が高くなるようで、以下のように二重に、しかも優先的に食らっていたようでした。


```bash
   デフォルト ゲートウェイ . . . . . . .: fe80::6ee4:daff:fe6b:b2a8%11
                                          192.168.10.1
   DHCP サーバー . . . . . . . . . . . .: 192.168.10.30
   DHCPv6 IAID . . . . . . . . . . . . .: 216036327
   DHCPv6 クライアント DUID. . . . . . .: 00-01-00-01-2E-D4-6B-B4-E0-73-E7-C8-AD-C3
   DNS サーバー. . . . . . . . . . . . .: 2404:7a81:e340:ee00:6ee4:daff:fe6b:b2a8 #←こいつが優先されていた
                                          192.168.10.30
                                          2404:7a81:e340:ee00:6ee4:daff:fe6b:b2a8
   NetBIOS over TCP/IP . . . . . . . . .: 有効
```

設定変更後
```bash
   デフォルト ゲートウェイ . . . . . . .: fe80::6ee4:daff:fe6b:b2a8%11
                                          192.168.10.1
   DHCP サーバー . . . . . . . . . . . .: 192.168.10.30
   DHCPv6 IAID . . . . . . . . . . . . .: 216036327
   DHCPv6 クライアント DUID. . . . . . .: 00-01-00-01-2E-D4-6B-B4-E0-73-E7-C8-AD-C3
   DNS サーバー. . . . . . . . . . . . .: 192.168.10.30
                                          2404:7a81:e340:ee00:6ee4:daff:fe6b:b2a8
   NetBIOS over TCP/IP . . . . . . . . .: 有効
```


これと関係あるかどうかわかりませんが、リバースプロキシのVMを再起動したらwebUIが初期のwelcomeページになっていてこれも直さなきゃいけないみたいです…。