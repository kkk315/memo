---
data: 2025-07-21
---

クラスタを組んでいるラックサーバーがバカみたいにうるさかったため船から降ろし、クラスタを解除してメインノードの単独に戻しました。

## 手順
Proxmoxクラスタはノード全体のうち半数以上が停止しているとno quorumのようなエラーが出てVMのクローンも起動も何もできなくなるようです。現在は2ノード構成のため、片方を停止しただけで何もできなくなりました。
そのため、
- ノードを削除
- クラスタを解除（単独にする）
をやっていきます。
また、クラスタ中は各種設定がノード同士で同期されるため、ノードを削除する際は削除される側（今回はpve2）も起動しておく必要があるようです。


## ノードをクラスタから削除
クラスタ構成に関してはwebUIからは操作できないため、ホスト上での操作します。

まずはノードを確認
```bash
pvecm nodes
# 削除したいノード名を確認する
```

自分の環境では``pve``と``pve2``のノードがあり、今回は``pve2``を削除します。


```bash
pvecm delnode pxm2
```

同期ファイルのパーミッションエラーが出ますが、削除は完了します。

もう一度ノードを表示し、pve2が消えていることを確認します。
```bash
pvecm nodes
```

クラスターと設定ファイルの同期を停止
```bash
systemctl stop pve-cluster corosync
```

読み取りモードでpmxcfsを起動
```bash
killall pmxcfs 
pmxcfs -l
```
クラスター構成ファイルの削除
```bash
rm /etc/pve/corosync.conf
rm -r /etc/corosync/*
```

ノード情報を削除
``pmx2``の部分は消したいノード名に変更してください。

```bash
ls /etc/pve/nodes/  # 削除対象を確認（念の為）
rm -rf /etc/pve/nodes/pmx2
```


読み取りモードのpmxcfsを停止
```bash
killall pmxcfs
```

クラスター再起動
```bash
systemctl start pve-cluster
```


これで単独ノードになりました。